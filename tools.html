<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>服务器常用维护命令</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 16px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 8px;
        }
        
        header {
            text-align: center;
            margin-bottom: 24px;
            padding: 20px 16px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            background: linear-gradient(90deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .subtitle {
            font-size: 0.95rem;
            color: #94a3b8;
            line-height: 1.6;
            margin-top: 8px;
        }
        
        .commands-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .command-card {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 14px;
            padding: 20px 18px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.25s ease;
        }
        
        .command-card:active {
            transform: scale(0.995);
        }
        
        .command-header {
            display: flex;
            flex-direction: column;
            margin-bottom: 16px;
            padding-bottom: 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .command-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .command-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 0; /* 允许文本溢出省略 */
        }
        
        .command-title-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .command-category {
            display: inline-block;
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 8px;
            white-space: nowrap;
        }
        
        .command-actions {
            display: flex;
            gap: 10px;
            justify-content: space-between;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 0.95rem;
            flex: 1;
            min-width: 80px;
        }
        
        .btn-edit {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .btn-edit:active {
            background: rgba(59, 130, 246, 0.25);
        }
        
        .btn-copy {
            background: rgba(16, 185, 129, 0.15);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .btn-copy:active {
            background: rgba(16, 185, 129, 0.25);
        }
        
        .btn-reset {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .btn-reset:active {
            background: rgba(245, 158, 11, 0.25);
        }
        
        .command-content {
            margin-bottom: 16px;
        }
        
        .command-text {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 10px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.5;
            color: #cbd5e0;
            white-space: pre-wrap;
            word-break: break-all;
            border: 1px solid rgba(255, 255, 255, 0.05);
            min-height: 60px;
            margin-bottom: 12px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .command-editor {
            width: 100%;
            min-height: 140px;
            background: rgba(15, 23, 42, 0.95);
            border-radius: 10px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.5;
            color: #cbd5e0;
            border: 1px solid rgba(59, 130, 246, 0.5);
            resize: vertical;
            display: none;
        }
        
        .editor-actions {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-top: 12px;
            display: none;
        }
        
        .btn-save {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
            flex: 1;
        }
        
        .btn-cancel {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
            flex: 1;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            background: rgba(16, 185, 129, 0.95);
            color: white;
            font-weight: 600;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(150%);
            transition: transform 0.4s ease;
            backdrop-filter: blur(10px);
        }
        
        .notification.show {
            transform: translateY(0);
        }
        
        .notification.error {
            background: rgba(239, 68, 68, 0.95);
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #94a3b8;
            font-size: 0.85rem;
            padding-bottom: 20px;
        }
        
        .usage-tips {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 14px;
            padding: 20px;
            margin-top: 24px;
            border-left: 5px solid #3b82f6;
        }
        
        .usage-tips h3 {
            margin-bottom: 12px;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }
        
        .usage-tips ul {
            padding-left: 20px;
        }
        
        .usage-tips li {
            margin-bottom: 10px;
            line-height: 1.6;
            font-size: 0.9rem;
        }
        
        .command-icon {
            width: 40px;
            height: 40px;
            background: rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #60a5fa;
            flex-shrink: 0;
        }
        
        /* 移动端优化 */
        @media (max-width: 480px) {
            body {
                padding: 12px 10px;
            }
            
            .container {
                padding: 0 4px;
            }
            
            header {
                padding: 18px 14px;
                margin-bottom: 20px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .command-card {
                padding: 18px 16px;
            }
            
            .command-title {
                font-size: 1.15rem;
            }
            
            .command-text, .command-editor {
                font-size: 0.9rem;
                padding: 14px;
            }
            
            .btn {
                padding: 10px 12px;
                font-size: 0.9rem;
                min-width: 70px;
            }
            
            .command-actions {
                gap: 8px;
            }
            
            .notification {
                left: 10px;
                right: 10px;
                bottom: 10px;
                padding: 14px 16px;
                font-size: 0.95rem;
            }
        }
        
        /* 极窄屏幕优化 */
        @media (max-width: 360px) {
            h1 {
                font-size: 1.4rem;
            }
            
            .command-title {
                font-size: 1.1rem;
            }
            
            .btn {
                padding: 9px 10px;
                font-size: 0.85rem;
            }
            
            .command-category {
                font-size: 0.75rem;
                padding: 3px 8px;
            }
        }
        
        /* 防止移动端输入框缩放 */
        input, textarea {
            font-size: 16px !important;
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <i class="fas fa-server"></i>
                <span>服务器维护命令</span>
            </h1>
            <p class="subtitle">可直接编辑命令内容，然后一键复制到剪贴板。所有命令已按类别分组，便于快速查找和使用。</p>
        </header>
        
        <main>
            <div class="commands-container" id="commandsContainer">
                <!-- 命令卡片将通过JavaScript动态生成 -->
            </div>
            
            <div class="usage-tips">
                <h3><i class="fas fa-lightbulb"></i> 使用说明</h3>
                <ul>
                    <li><strong>编辑命令</strong>：点击"编辑"按钮修改命令内容</li>
                    <li><strong>复制命令</strong>：点击"复制"按钮将命令复制到剪贴板</li>
                    <li><strong>重置命令</strong>：点击"重置"按钮恢复命令原始内容</li>
                    <li><strong>保存修改</strong>：编辑后点击"保存"按钮保存更改</li>
                    <li><strong>取消编辑</strong>：编辑后点击"取消"按钮放弃更改</li>
                </ul>
            </div>
        </main>
        
        <footer>
            <p>服务器维护命令工具 &copy; 2023</p>
            <p style="margin-top: 6px; font-size: 0.8rem; color: #64748b;">注意：使用命令前请确保了解命令作用，避免对服务器造成意外影响。</p>
        </footer>
        
        <div class="notification" id="notification">
            <i class="fas fa-check-circle"></i>
            <span>命令已成功复制到剪贴板！</span>
        </div>
    </div>

    <script>
        // 命令数据
        const commands = [
            {
                id: 1,
                title: "重启前端引擎",
                command: "systemctl restart nginx",
                category: "服务管理",
                icon: "fas fa-redo"
            },
            {
                id: 2,
                title: "引擎状态",
                command: "systemctl status nginx",
                category: "服务管理",
                icon: "fas fa-info-circle"
            },
            {
                id: 3,
                title: "测试配置",
                command: "nginx -t",
                category: "配置检查",
                icon: "fas fa-vial"
            },
            {
                id: 4,
                title: "ACME 升级",
                command: "acme.sh --upgrade",
                category: "ACME 相关",
                icon: "fas fa-arrow-up"
            },
            {
                id: 5,
                title: "进入规则目录",
                command: "cd /www/server/panel/vhost/rule",
                category: "规则目录操作",
                icon: "fas fa-folder-open"
            },
            {
                id: 6,
                title: "规则目录列表",
                command: "ls -la /www/server/panel/vhost/rule",
                category: "规则目录操作",
                icon: "fas fa-list"
            },
            {
                id: 7,
                title: "规则目录统计",
                command: "ls /www/server/panel/vhost/rule | wc -l",
                category: "规则目录操作",
                icon: "fas fa-calculator"
            },
            {
                id: 8,
                title: "查找特定规则文件",
                command: 'find /www/server/panel/vhost/rule -name "*.conf"',
                category: "规则目录操作",
                icon: "fas fa-search"
            },
            {
                id: 9,
                title: "向指定文件第一行插入代码",
                command: "sed -i '1i allow 8.8.8.0/24;' fIP.conf",
                category: "文件编辑",
                icon: "fas fa-edit"
            },
            {
                id: 10,
                title: "删除第一行代码",
                command: "sed -i '1d' fIP.conf",
                category: "文件编辑",
                icon: "fas fa-trash-alt"
            },
            {
                id: 11,
                title: "当前目录所有文件在第一行增加代码",
                command: `for file in *; do
  [ -f "$file" ] && sed -i '1i allow 182.246.40.27;' "$file"
done`,
                category: "文件编辑",
                icon: "fas fa-file-code"
            },
            {
                id: 12,
                title: "当前目录所有文件删除第一行代码",
                command: `for file in *; do
  [ -f "$file" ] && sed -i '1d' "$file"
done`,
                category: "文件编辑",
                icon: "fas fa-trash"
            }
        ];

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            const commandsContainer = document.getElementById('commandsContainer');
            
            // 生成命令卡片
            commands.forEach(cmd => {
                const commandCard = createCommandCard(cmd);
                commandsContainer.appendChild(commandCard);
            });
            
            // 创建命令卡片
            function createCommandCard(cmd) {
                const card = document.createElement('div');
                card.className = 'command-card';
                card.dataset.id = cmd.id;
                
                // 生成卡片HTML
                card.innerHTML = `
                    <div class="command-header">
                        <div class="command-title-row">
                            <div class="command-title">
                                <div class="command-icon">
                                    <i class="${cmd.icon}"></i>
                                </div>
                                <div class="command-title-text">${cmd.title}</div>
                            </div>
                            <span class="command-category">${cmd.category}</span>
                        </div>
                    </div>
                    <div class="command-content">
                        <div class="command-text" id="command-text-${cmd.id}">${escapeHtml(cmd.command)}</div>
                        <textarea class="command-editor" id="command-editor-${cmd.id}">${escapeHtml(cmd.command)}</textarea>
                        <div class="command-actions">
                            <button class="btn btn-edit" onclick="editCommand(${cmd.id})">
                                <i class="fas fa-edit"></i> <span class="btn-text">编辑</span>
                            </button>
                            <button class="btn btn-copy" onclick="copyCommand(${cmd.id})">
                                <i class="fas fa-copy"></i> <span class="btn-text">复制</span>
                            </button>
                            <button class="btn btn-reset" onclick="resetCommand(${cmd.id})">
                                <i class="fas fa-undo"></i> <span class="btn-text">重置</span>
                            </button>
                        </div>
                        <div class="editor-actions" id="editor-actions-${cmd.id}">
                            <button class="btn btn-cancel" onclick="cancelEdit(${cmd.id})">
                                <i class="fas fa-times"></i> <span class="btn-text">取消</span>
                            </button>
                            <button class="btn btn-save" onclick="saveCommand(${cmd.id})">
                                <i class="fas fa-check"></i> <span class="btn-text">保存</span>
                            </button>
                        </div>
                    </div>
                `;
                
                return card;
            }
            
            // 转义HTML特殊字符
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            // 显示通知
            window.showNotification = function(message, isError = false) {
                const notification = document.getElementById('notification');
                const icon = notification.querySelector('i');
                const text = notification.querySelector('span');
                
                text.textContent = message;
                
                if (isError) {
                    notification.classList.add('error');
                    icon.className = 'fas fa-exclamation-circle';
                } else {
                    notification.classList.remove('error');
                    icon.className = 'fas fa-check-circle';
                }
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            };
            
            // 复制命令
            window.copyCommand = function(id) {
                const commandText = document.getElementById(`command-text-${id}`);
                const textToCopy = commandText.textContent;
                
                // 使用现代剪贴板API
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showNotification('命令已复制到剪贴板！');
                    }).catch(err => {
                        console.error('复制失败: ', err);
                        fallbackCopy(textToCopy);
                    });
                } else {
                    // 降级方案
                    fallbackCopy(textToCopy);
                }
            };
            
            // 降级复制方案
            function fallbackCopy(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showNotification('命令已复制到剪贴板！');
                    } else {
                        showNotification('复制失败，请手动选择并复制', true);
                    }
                } catch (err) {
                    console.error('降级复制失败: ', err);
                    showNotification('复制失败，请手动选择并复制', true);
                }
                
                document.body.removeChild(textArea);
            }
            
            // 编辑命令
            window.editCommand = function(id) {
                const commandText = document.getElementById(`command-text-${id}`);
                const commandEditor = document.getElementById(`command-editor-${id}`);
                const editorActions = document.getElementById(`editor-actions-${id}`);
                const cardActions = commandText.parentElement.querySelector('.command-actions');
                
                commandText.style.display = 'none';
                commandEditor.style.display = 'block';
                cardActions.style.display = 'none';
                editorActions.style.display = 'flex';
                
                // 自动聚焦并滚动到可见区域
                setTimeout(() => {
                    commandEditor.focus();
                    commandEditor.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            };
            
            // 保存命令
            window.saveCommand = function(id) {
                const commandText = document.getElementById(`command-text-${id}`);
                const commandEditor = document.getElementById(`command-editor-${id}`);
                const editorActions = document.getElementById(`editor-actions-${id}`);
                const cardActions = commandText.parentElement.querySelector('.command-actions');
                const originalCommand = commands.find(cmd => cmd.id === id).command;
                
                const newCommand = commandEditor.value.trim();
                
                if (newCommand === '') {
                    showNotification('命令不能为空', true);
                    return;
                }
                
                commandText.textContent = newCommand;
                commandText.style.display = 'block';
                commandEditor.style.display = 'none';
                editorActions.style.display = 'none';
                cardActions.style.display = 'flex';
                
                showNotification('命令修改已保存！');
            };
            
            // 取消编辑
            window.cancelEdit = function(id) {
                const commandText = document.getElementById(`command-text-${id}`);
                const commandEditor = document.getElementById(`command-editor-${id}`);
                const editorActions = document.getElementById(`editor-actions-${id}`);
                const cardActions = commandText.parentElement.querySelector('.command-actions');
                const originalCommand = commands.find(cmd => cmd.id === id).command;
                
                commandEditor.value = originalCommand;
                commandText.style.display = 'block';
                commandEditor.style.display = 'none';
                editorActions.style.display = 'none';
                cardActions.style.display = 'flex';
                
                showNotification('已取消编辑', true);
            };
            
            // 重置命令
            window.resetCommand = function(id) {
                const commandText = document.getElementById(`command-text-${id}`);
                const commandEditor = document.getElementById(`command-editor-${id}`);
                const originalCommand = commands.find(cmd => cmd.id === id).command;
                
                commandText.textContent = originalCommand;
                commandEditor.value = originalCommand;
                
                showNotification('命令已重置为原始内容');
            };
            
            // 防止移动端双击缩放
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        });
    </script>
</body>
</html>